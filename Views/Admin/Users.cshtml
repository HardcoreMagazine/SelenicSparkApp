@using Microsoft.AspNetCore.Identity;
@using SelenicSparkApp.Data @* Normally I would advise against using that *@

@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
@inject ApplicationDbContext AppDbContext // Normally I would advise against using that *@

@model IEnumerable<IdentityUser>
@{
    ViewData["Title"] = "Manage users";
}

<style>
	table {
		width: 100%;
		border: 1px solid;
		border-collapse: collapse;
	}
	table th {
		border: 1px solid;
		background: #c0c0c0;
		text-align: center;
	}

	table td {
		font-size:14px;
		border: 1px solid;
		text-align: center;
		padding: 5px;
	}
</style>

@*
	BY DEFAULT THIS PAGE DISPLAYS WHOLE USER DATABASE, 
	THIS PROJECT MADE WITH THOUGHT IN MIND OF LOW USERS COUNT DATABASE, 
	FEEL FREE TO MODIFY IT, ADD PAGES & ETC
*@
@if (SignInManager.IsSignedIn(User))
{
    @if (User.IsInRole("Admin")) // Triple-checking never hurt anyone
    {
        <div>
            <h1 style="text-align:center;">
                Hello, @User.Identity?.Name
            </h1>
			<hr />
			<p style="text-align:center;color:darkred;font-size:14px; font-weight:bold;">
				Note that only primary fields are being dispalyed.
			</p>
			<table>
				<thead>
					<tr>
						<th>ID</th>
						<th>Username</th>
						<th>Role(s)</th>
						<th>Email</th>
						<th>Valid</th>
						<th>Ban until</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
				<tbody>
					@foreach (var user in UserManager.Users)
					{
						<tr>
							<td>@user.Id</td>
							<td>@user.UserName</td>
							<td>
								@{
									// Normally user would have only 1 role
									// But just in case...
									var roles = await UserManager.GetRolesAsync(user);
									var rolesList = "";
									foreach (var role in roles)
									{
										rolesList += $"{role};\n";
									}
									@rolesList
								}
							</td>
							<td>@user.Email</td>
							<td>@user.EmailConfirmed</td>
							<td>@user.LockoutEnd</td>
							<td>
								<a asp-action="EditUser" asp-route-id="@user.Id">EDIT</a>
							</td>
							<td style="background-color:#fae8ed;">
								<a asp-action="DeleteUser" asp-route-id="@user.Id">DEL</a>
							</td>
						</tr>
					}
				</tbody>
			</table>
        </div>
    }
}
